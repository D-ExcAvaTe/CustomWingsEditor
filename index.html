<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wing Config Generator</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: row;
      padding: 20px;
      gap: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(20, 20px);
      gap: 2px;
    }

    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      text-align: center;
      font-size: 12px;
      line-height: 20px;
      cursor: pointer;
    }

    .cell.active {
      background-color: #444;
      color: #fff;
    }

    .controls, .preview {
      flex: 1;
    }

    .symbol-preview {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .symbol-box {
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
      border: 1px solid #ccc;
    }

    .symbol-config {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
    }

    textarea {
      width: 100%;
      height: 150px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <h3>Wing Grid</h3>
    <label>Rows: <input type="number" id="rows" value="10"></label>
    <label>Cols: <input type="number" id="cols" value="20"></label>
    <button onclick="generateGrid()">Generate</button>
    <br/><br/>
    <label>Current Symbol: <input id="symbol" value="x" maxlength="1"></label>
    <div id="grid" class="grid"></div>
    <br/>
    <button onclick="downloadYml()">Download .yml</button>
  </div>

  <div class="preview">
    <h3>Symbol Config</h3>
    <div id="symbolConfigs"></div>
    <button onclick="addSymbolConfig()">+ Add Symbol</button>

    <h3>Preview</h3>
    <div id="previewBox" class="symbol-preview"></div>

    <h3>YML Output</h3>
    <textarea id="output" readonly></textarea>
  </div>

  <script>
    let gridData = [];
    let isDragging = false;
    let rows = 10;
    let cols = 20;

    const symbolConfigs = {};
    const previewBox = document.getElementById("previewBox");
    const gridContainer = document.getElementById("grid");
    const outputBox = document.getElementById("output");

    function generateGrid() {
      rows = parseInt(document.getElementById("rows").value);
      cols = parseInt(document.getElementById("cols").value);
      gridContainer.innerHTML = "";
      gridData = [];

      for (let r = 0; r < rows; r++) {
        const row = [];
        for (let c = 0; c < cols; c++) {
          const div = document.createElement("div");
          div.className = "cell";
          div.dataset.row = r;
          div.dataset.col = c;
          div.onmousedown = handleCellClick;
          div.onmouseover = handleDrag;
          gridContainer.appendChild(div);
          row.push("");
        }
        gridData.push(row);
      }
    }

    function handleCellClick(e) {
      isDragging = true;
      const row = parseInt(e.target.dataset.row);
      const col = parseInt(e.target.dataset.col);
      const currentSymbol = document.getElementById("symbol").value || "x";
      const current = gridData[row][col];
      if (current === currentSymbol) {
        gridData[row][col] = "";
        e.target.classList.remove("active");
        e.target.textContent = "";
      } else {
        gridData[row][col] = currentSymbol;
        e.target.classList.add("active");
        e.target.textContent = currentSymbol;
      }
      renderOutput();
    }

    function handleDrag(e) {
      if (!isDragging) return;
      const row = parseInt(e.target.dataset.row);
      const col = parseInt(e.target.dataset.col);
      const currentSymbol = document.getElementById("symbol").value || "x";
      const current = gridData[row][col];
      if (current !== currentSymbol) {
        gridData[row][col] = currentSymbol;
        e.target.classList.add("active");
        e.target.textContent = currentSymbol;
      }
      renderOutput();
    }

    document.body.onmouseup = () => {
      isDragging = false;
    };

    function addSymbolConfig() {
      const container = document.createElement("div");
      container.className = "symbol-config";

      const symbol = prompt("Enter symbol (1 char):");
      if (!symbol || symbol.length !== 1) return;

      symbolConfigs[symbol] = {};

      container.innerHTML = `
        <strong>Symbol: ${symbol}</strong><br/>
        Particle: <input value="" placeholder="e.g. REDSTONE" oninput="updateConfig('${symbol}', 'particle', this.value)"><br/>
        Color (hex): <input placeholder="e.g. 0xFF0000" oninput="updateConfig('${symbol}', 'color', this.value)"><br/>
        Distance: <input type="number" step="0.01" oninput="updateConfig('${symbol}', 'distance', this.value)"><br/>
        Height: <input type="number" step="0.01" oninput="updateConfig('${symbol}', 'height', this.value)"><br/>
        Angle: <input type="number" step="1" oninput="updateConfig('${symbol}', 'angle', this.value)"><br/>
        Speed: <input type="number" step="0.01" oninput="updateConfig('${symbol}', 'speed', this.value)"><br/>
        Block Type: <input placeholder="DIRT" oninput="updateConfig('${symbol}', 'blockType', this.value)"><br/>
      `;

      document.getElementById("symbolConfigs").appendChild(container);

      const preview = document.createElement("div");
      preview.className = "symbol-box";
      preview.textContent = symbol;
      previewBox.appendChild(preview);
    }

    function updateConfig(symbol, key, value) {
      if (!symbolConfigs[symbol]) return;
      if (!value) {
        delete symbolConfigs[symbol][key];
      } else {
        symbolConfigs[symbol][key] = isNaN(value) || key === "particle" || key === "color" || key === "blockType" ? value : parseFloat(value);
      }
      renderOutput();
    }

    function renderOutput() {
      let layout = "";
      let particles = "";

      for (let r = 0; r < gridData.length; r++) {
        const row = gridData[r].map(cell => cell || "-").join(",");
        layout += `    ${r + 1}: "${row}"\n`;
      }

      let particleDefs = "";
      for (const [symbol, config] of Object.entries(symbolConfigs)) {
        particleDefs += `    ${symbol}:\n`;
        for (const [k, v] of Object.entries(config)) {
          if (k === "particle") {
            particleDefs += `      ${k}: "${v}"\n`;
          } else {
            particleDefs += `      ${k}: ${v}\n`;
          }
        }
      }

      const yml = `menuItem:\n  name: "&fMy Wing"\n  material: FEATHER\n  slot: 0\n  page: 1\n\nwing:\n  startVertical: 0.0\n  startDistanceToPlayer: 0.2\n  distanceBetweenParticles: 0.1\n  timer: 2\n\n  particleLayout:\n${layout}\n  particles:\n${particleDefs}`;
      outputBox.value = yml;
    }

    function downloadYml() {
      const blob = new Blob([outputBox.value], { type: "text/yaml" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "wing.yml";
      link.click();
    }

    generateGrid();
  </script>
</body>
</html>
